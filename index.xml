<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving
and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">

<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">

<front>
<journal-meta>
<journal-id></journal-id>

<journal-title-group>
<journal-title>Earth and Space Science</journal-title>
</journal-title-group>
<issn></issn>

<publisher>
<publisher-name></publisher-name>
</publisher>
</journal-meta>


<article-meta>


<title-group>
<article-title>Temporal and spatial variations of PM2 and PM10
concentrations in Mongolia</article-title>
</title-group>

<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0001-9775-1924</contrib-id>
<name>
<surname>Munkhtsetseg</surname>
<given-names>Erdenebayar</given-names>
</name>
<string-name>Erdenebayar Munkhtsetseg</string-name>

<email>e.munkhtsetseg@yahoo.com</email>
<role vocab="https://credit.niso.org" vocab-term="investigation" vocab-term-identifier="https://credit.niso.org/contributor-roles/investigation/">Investigation</role>
<role vocab="https://credit.niso.org" vocab-term="project
administration" vocab-term-identifier="https://credit.niso.org/contributor-roles/project-administration/">Project
administration</role>
<role vocab="https://credit.niso.org" vocab-term="software" vocab-term-identifier="https://credit.niso.org/contributor-roles/software/">Software</role>
<role vocab="https://credit.niso.org" vocab-term="visualization" vocab-term-identifier="https://credit.niso.org/contributor-roles/visualization/">Visualization</role>
<xref ref-type="aff" rid="aff-1">a</xref>
<xref ref-type="aff" rid="aff-2">b</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">0000-0000-0000-0000</contrib-id>
<name>
<surname>Shimizu</surname>
<given-names>Atsushi</given-names>
</name>
<string-name>Atsushi Shimizu</string-name>

<email>shimizua@nies.go.jp</email>
<role vocab="https://credit.niso.org" vocab-term="writing – review &amp;
editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing/">Editing</role>
<role>Revising</role>
<xref ref-type="aff" rid="aff-3">c</xref>
<xref ref-type="corresp" rid="cor-2">&#x002A;</xref>
</contrib>
</contrib-group>
<aff id="aff-1">
<institution-wrap>
<institution>National University of Mongolia (NUM),
Mongolia</institution>
</institution-wrap>







</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Kanazawa University, Japan</institution>
</institution-wrap>







</aff>
<aff id="aff-3">
<institution-wrap>
<institution>National Institute for Environmental Studies (NIES),
Japan</institution>
</institution-wrap>







</aff>
<author-notes>
<corresp id="cor-2">shimizua@nies.go.jp</corresp>
</author-notes>

<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2024-01-24">
<year>2024</year>
<month>1</month>
<day>24</day>
</pub-date>







<history></history>


<abstract>
<p>PM2.5 and PM10 data for the 4 distinct sites of Mongolia from 2008 to
2020 is found …. …</p>
</abstract>
<kwd-group kwd-group-type="author">
<kwd>particulate matters</kwd>
<kwd>concentrations of PM10 and PM2.5</kwd>
</kwd-group>




</article-meta>

</front>

<body>
<sec id="sec-data-methods">
  <title>0.1 Data &amp; Methods</title>
</sec>
<sec id="datawork">
  <title>1. 01_datawork</title>
  <p>Munkhtsetseg</p>
  <p>Library</p>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates">
  <title>2. Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="produce-a-table-with-missing-data">
    <title>2.1 Produce a table with missing data</title>
    <p>For date options as year, month, etc:</p>
    <preformat># A tibble: 35 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 2 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 3 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 4 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 5 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 6 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 7 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 8 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
 9 Sainshand     2009    8688    376     424    423   587   587   8688
10 Sainshand     2010    8784   2557    2577   1113  1210  1210   8784
# ℹ 25 more rows</preformat>
    <p>For station</p>
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    60336  11164   14270  26524 14004 14004  60336
2 Sainshand      59040  11727   11929   9320  8527  8527  59040
3 UB             76656   7879    8716   3770  4053  4053  43415
4 Zamynuud       67392   8880   10075   3444  4960  4960  67392</preformat>
    <p>By percentages</p>
    <preformat># A tibble: 4 × 6
# Groups:   Station.name [4]
  Station.name missing_PM2 missing_PM10 missing_Vis missing_WS missing_WD
  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Dalanzadgad         25.7         19.2       44.5       24.3       24.3 
2 Sainshand           20.0         19.7       15.7       14.6       14.6 
3 UB                  11.9         11.0        4.53       4.85       4.85
4 Zamynuud            14.4         12.7        5.49       7.44       7.44</preformat>
  </sec>
</sec>
<sec id="note-that">
  <title>3. Note that:</title>
  <p>We use the data in the period of 2009-2018, which has been regarded
  as a monitoring work stabilized since 2008 when is the beginning of
  the monitoring. According to NIES, site maintenance was consistent up
  to 2018. - Sainshand site, data 2009-2015 get used; - Dalanzad site:
  2009-2016. - UB: 2009-2018 - Zamyn uud: 2009-2018</p>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table">
  <title>4. Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages. ### Remove the
  spikes Method 1. Mean value +- (3-5)SD - Find Monthly mean</p>
  <preformat># A tibble: 1,798 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     2    17 Outl… 0.29        3622   141 0.524    NA UB          
 2  2009     1     3    12 Outl… 0.446       2399   109 0.117    NA UB          
 3  2009     1     3    13 Outl… 0.288       1347    17 0.492    NA UB          
 4  2009     1     3    14 Outl… 0.504       1241    12 0.829    NA UB          
 5  2009     1     3    15 Outl… 0.478       1341    11 0.39     NA UB          
 6  2009     1     3    16 Outl… 0.449       2945   136 0.123    NA UB          
 7  2009     1     3    18 Outl… 0.341       1436    13 0.742    NA UB          
 8  2009     1     3    19 Outl… 0.397       1847    13 0.453    NA UB          
 9  2009     1     3    20 Outl… 0.297       3359    22 0.462    NA UB          
10  2009     1     4     2 Outl… 0.311       3167    96 0.759    NA UB          
# ℹ 1,788 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  <preformat># A tibble: 4,014 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     3    15 Outl… 0.292       3444   119 0.856    NA Dalanzadgad 
 2  2009     1     5    13 Outl… 0.419       1383   260 1.7      NA Dalanzadgad 
 3  2009     1     5    14 Outl… 0.415       1072   266 1.84     NA Dalanzadgad 
 4  2009     1     5    15 Outl… 0.466       1099   261 0.83     NA Dalanzadgad 
 5  2009     1     5    16 Outl… 0.509       1814   260 0.788    NA Dalanzadgad 
 6  2009     1     6     0 Outl… 0.547        744   248 1.23     NA Dalanzadgad 
 7  2009     1     6     1 Outl… 0.728       1093   277 0.738    NA Dalanzadgad 
 8  2009     1     6     2 Outl… 0.597       1723     0 1.62     NA Dalanzadgad 
 9  2009     1     6     3 Outl… 0.33        8186    95 1.1      NA Dalanzadgad 
10  2009     1     6    11 Outl… 0.39        1150   258 1.48     NA Dalanzadgad 
# ℹ 4,004 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  <sec id="save-dataset-in-folder-01_data_raw">
    <title>4.1 Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data">
  <title>5. Tidy data</title>
  <sec id="fill-the-missing-data">
    <title>5.1 Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy">
    <title>5.2 Save dataset in folder: 02_data_tidy</title>
  </sec>
  <sec id="introduction">
    <title>5.3 Introduction</title>
    <fig id="fig-timeline">
      <caption><p>Figure 1: Timeline of recent earthquakes on La
      Palma</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-timeline-1.png" />
    </fig>
    <p>Based on data up to and including 1971, eruptions on La Palma
    happen every 79.8 years on average.</p>
    <p>Studies of the magma systems feeding the volcano, such as Marrero
    et al.
    (<xref alt="2019" rid="ref-marrero2019" ref-type="bibr">2019</xref>),
    have proposed that there are two main magma reservoirs feeding the
    Cumbre Vieja volcano; one in the mantle (30-40km depth) which
    charges and in turn feeds a shallower crustal reservoir (10-20km
    depth).</p>
    <p>Eight eruptions have been recorded since the late 1400s
    (<xref alt="Figure 1" rid="fig-timeline">Figure 1</xref>).</p>
    <p>Data and methods are discussed in
    <xref alt="Section 0.1" rid="sec-data-methods">Section 0.1</xref>.</p>
    <p>Let <inline-formula><alternatives>
    <tex-math><![CDATA[x]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
    denote the number of eruptions in a year. Then,
    <inline-formula><alternatives>
    <tex-math><![CDATA[x]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
    can be modeled by a Poisson distribution</p>
    <p><styled-content id="eq-poisson"><disp-formula><alternatives>
    <tex-math><![CDATA[
    p(x) = \frac{e^{-\lambda} \lambda^{x}}{x !}
     \qquad(1)]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mi>λ</mml:mi><mml:mi>x</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>!</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="2.0em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></styled-content></p>
    <p>where <inline-formula><alternatives>
    <tex-math><![CDATA[\lambda]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>λ</mml:mi></mml:math></alternatives></inline-formula>
    is the rate of eruptions per year. Using
    <xref alt="Equation 1" rid="eq-poisson">Equation 1</xref>, the
    probability of an eruption in the next
    <inline-formula><alternatives>
    <tex-math><![CDATA[t]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>t</mml:mi></mml:math></alternatives></inline-formula>
    years can be calculated.</p>
    <fig id="tbl-history">
      <caption><p>Table 1: Recent historic eruptions on La
      Palma</p></caption>
      <table-wrap>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Year</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Current</td>
              <td>2021</td>
            </tr>
            <tr>
              <td>Teneguía</td>
              <td>1971</td>
            </tr>
            <tr>
              <td>Nambroque</td>
              <td>1949</td>
            </tr>
            <tr>
              <td>El Charco</td>
              <td>1712</td>
            </tr>
            <tr>
              <td>Volcán San Antonio</td>
              <td>1677</td>
            </tr>
            <tr>
              <td>Volcán San Martin</td>
              <td>1646</td>
            </tr>
            <tr>
              <td>Tajuya near El Paso</td>
              <td>1585</td>
            </tr>
            <tr>
              <td>Montaña Quemada</td>
              <td>1492</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
    <p><xref alt="Table 1" rid="tbl-history">Table 1</xref> summarises
    the eruptions recorded since the colonization of the islands by
    Europeans in the late 1400s.</p>
    <fig id="fig-map">
      <caption><p>Figure 2: Map of La Palma</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/la-palma-map.png" />
    </fig>
    <p>La Palma is one of the west most islands in the Volcanic
    Archipelago of the Canary Islands
    (<xref alt="Figure 2" rid="fig-map">Figure 2</xref>).</p>
    <fig id="fig-spatial-plot">
      <caption><p>Figure 3: Locations of earthquakes on La Palma since
      2017</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" />
    </fig>
    <p>kk</p>
  </sec>
</sec>
<sec id="explore-earthquakes">
  <title>6. Explore Earthquakes</title>
  <p>Munkhtsetseg</p>
  <p>Library</p>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates-1">
  <title>7. Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="produce-a-table-with-missing-data-1">
    <title>7.1 Produce a table with missing data</title>
    <p>For date options as year, month, etc:</p>
    <preformat># A tibble: 52 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2008    4630   1543    1672   1463  1566  1566   4630
 2 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 3 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 4 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 5 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 6 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 7 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 8 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 9 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
10 Dalanzadgad   2017    3264     36      45   3264  3264  3264   3264
# ℹ 42 more rows</preformat>
    <p>For station</p>
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    69454  13081   16327  32475 20058 20058  69454
2 Sainshand     101230  27588   36117  28986 13768 13768 101230
3 UB             95662   7895    8785   3775  4121  4121  62421
4 Zamynuud       99742  32281   33597  22525  5373  5373  99742</preformat>
    <p>By percentages</p>
    <preformat># A tibble: 4 × 2
# Groups:   Station.name [4]
  Station.name   sdq
  &lt;chr&gt;        &lt;dbl&gt;
1 Dalanzadgad   10.7
2 Sainshand     25.9
3 UB            17.9
4 Zamynuud      39.6</preformat>
    <p>Note that the <monospace>echo = FALSE</monospace> parameter was
    added to the code chunk to prevent printing of the R code that
    generated the plot.</p>
  </sec>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table-1">
  <title>8. Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages.</p>
  <sec id="remove-the-spikes-method-1.-mean-value---3-5sd">
    <title>8.0.1 Remove the spikes Method 1. Mean value +-
    (3-5)SD</title>
    <p>Method 2. Seasonal variations, and trend-mean</p>
  </sec>
  <sec id="save-dataset-in-folder-01_data_raw-1">
    <title>8.1 Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data-1">
  <title>9. Tidy data</title>
  <sec id="fill-the-missing-data-1">
    <title>9.1 Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy-1">
    <title>9.2 Save dataset in folder: 02_data_tidy</title>
    <p>Read a clean version of data:</p>
    <p>Create spatial plot:</p>
    <fig id="fig-spatial-plot">
      <caption><p>Figure 4: Locations of earthquakes on La Palma since
      2017</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-01-earthquakes-fig-spatial-plot-output-1.png" />
    </fig>
    <p><xref alt="Figure 4" rid="fig-spatial-plot">Figure 4</xref> shows
    the location of recent Earthquakes on La Palma.</p>
  </sec>
  <sec id="sec-results">
    <title>9.3 Results</title>
  </sec>
  <sec id="sec-discussion">
    <title>9.4 Discussion</title>
  </sec>
  <sec id="sec-conclusions">
    <title>9.5 Conclusions</title>
  </sec>
  <sec id="references">
    <title>References</title>
    <ref-list>
      <ref id="ref-marrero2019">
        <element-citation publication-type="article-journal">
          <person-group person-group-type="author">
            <name><surname>Marrero</surname><given-names>José</given-names></name>
            <name><surname>García</surname><given-names>Alicia</given-names></name>
            <name><surname>Berrocoso</surname><given-names>Manuel</given-names></name>
            <name><surname>Llinares</surname><given-names>Ángeles</given-names></name>
            <name><surname>Rodríguez-Losada</surname><given-names>Antonio</given-names></name>
            <name><surname>Ortiz</surname><given-names>R.</given-names></name>
          </person-group>
          <article-title>Strategies for the development of volcanic hazard maps in monogenetic volcanic fields: The example of La Palma (Canary Islands)</article-title>
          <source>Journal of Applied Volcanology</source>
          <year iso-8601-date="2019-07">2019</year><month>07</month>
          <volume>8</volume>
          <pub-id pub-id-type="doi">10.1186/s13617-019-0085-5</pub-id>
          <fpage></fpage>
          <lpage></lpage>
        </element-citation>
      </ref>
    </ref-list>
  </sec>
</sec>
</body>

<back>
</back>

<sub-article article-type="notebook" id="nb-16-nb-article">
<front-stub>
<title-group>
<article-title>Temporal and spatial variations of PM2 and PM10
concentrations in Mongolia</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0001-9775-1924</contrib-id>
<name>
<surname>Munkhtsetseg</surname>
<given-names>Erdenebayar</given-names>
</name>
<string-name>Erdenebayar Munkhtsetseg</string-name>

<email>e.munkhtsetseg@yahoo.com</email>
<role vocab="https://credit.niso.org" vocab-term="investigation" vocab-term-identifier="https://credit.niso.org/contributor-roles/investigation/">Investigation</role>
<role vocab="https://credit.niso.org" vocab-term="project
administration" vocab-term-identifier="https://credit.niso.org/contributor-roles/project-administration/">Project
administration</role>
<role vocab="https://credit.niso.org" vocab-term="software" vocab-term-identifier="https://credit.niso.org/contributor-roles/software/">Software</role>
<role vocab="https://credit.niso.org" vocab-term="visualization" vocab-term-identifier="https://credit.niso.org/contributor-roles/visualization/">Visualization</role>
<xref ref-type="aff" rid="aff-1-nb-article">a</xref>
<xref ref-type="aff" rid="aff-2-nb-article">b</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">0000-0000-0000-0000</contrib-id>
<name>
<surname>Shimizu</surname>
<given-names>Atsushi</given-names>
</name>
<string-name>Atsushi Shimizu</string-name>

<email>shimizua@nies.go.jp</email>
<role vocab="https://credit.niso.org" vocab-term="writing – review &amp;
editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing/">Editing</role>
<role>Revising</role>
<xref ref-type="aff" rid="aff-3-nb-article">c</xref>
<xref ref-type="corresp" rid="cor-2-nb-article">&#x002A;</xref>
</contrib>
</contrib-group>
<aff id="aff-1-nb-article">
<institution-wrap>
<institution>National University of Mongolia (NUM),
Mongolia</institution>
</institution-wrap>







</aff>
<aff id="aff-2-nb-article">
<institution-wrap>
<institution>Kanazawa University, Japan</institution>
</institution-wrap>







</aff>
<aff id="aff-3-nb-article">
<institution-wrap>
<institution>National Institute for Environmental Studies (NIES),
Japan</institution>
</institution-wrap>







</aff>
<author-notes>
<corresp id="cor-2-nb-article">shimizua@nies.go.jp</corresp>
</author-notes>
<abstract>
<p>PM2.5 and PM10 data for the 4 distinct sites of Mongolia from 2008 to
2020 is found …. …</p>
</abstract>
</front-stub>

<body>
<sec id="sec-data-methods-nb-article">
  <title>0.1 Data &amp; Methods</title>
</sec>
<sec id="datawork-nb-article">
  <title>1. 01_datawork</title>
  <p>Munkhtsetseg</p>
  <p>Library</p>
  <sec id="ff6beceb-26d9-4e4a-8cbc-769993cfd746-nb-article" specific-use="notebook-code">
  <code language="python">library(tidyverse)</code>
  <sec id="ff6beceb-26d9-4e4a-8cbc-769993cfd746-output-0-nb-article" specific-use="notebook-output">
  <preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
  </sec>
  </sec>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates-nb-article">
  <title>2. Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <sec id="f3a47da8-abdd-4315-b4ba-1a1775cc914d-nb-article" specific-use="notebook-code">
  <code language="python">df &lt;- read.csv(&quot;~/Data Input/Preprocessing data/Preprocessing data.csv&quot;)</code>
  </sec>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="c37d56b5-a6a5-4d0e-9fc1-cd51d164e413-nb-article" specific-use="notebook-code">
  <code language="python">df_00 &lt;- df |&gt;
  distinct()</code>
  </sec>
  <sec id="produce-a-table-with-missing-data-nb-article">
    <title>2.1 Produce a table with missing data</title>
    <sec id="cell-8cc7f193-9648-4d46-ae9d-b68ea6651f46-nb-article" specific-use="notebook-code">
    <code language="python">df_000 &lt;- df_00 |&gt;
   filter(Year&lt;2019 &amp; Year &gt;2008)



df_01 &lt;- df_000 |&gt;
   select(Year, Month, Day, Hour, PM2, PM10, Visibility, WD, WS,   OPC, Station.name, Date) |&gt;
  rowwise() |&gt;
filter((Year != 2019 &amp; Station.name == &quot;Zamynuud&quot;) | 
       (Year &lt; 2016 &amp; Station.name == &quot;Sainshand&quot;) |
       (Year &lt; 2021 &amp; Station.name == &quot;UB&quot;) |
       (Year &lt; 2017 &amp; Station.name == &quot;Dalanzadgad&quot;)
       )</code>
    </sec>
    <p>For date options as year, month, etc:</p>
    <sec id="ed3796fc-da30-401e-9801-ca9e5280faed-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Year &lt;- df_01 |&gt;
  group_by(Station.name,Year) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
            ) </code>
    <sec id="ed3796fc-da30-401e-9801-ca9e5280faed-output-0-nb-article" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="ed3796fc-da30-401e-9801-ca9e5280faed-output-1-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 35 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 2 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 3 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 4 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 5 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 6 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 7 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 8 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
 9 Sainshand     2009    8688    376     424    423   587   587   8688
10 Sainshand     2010    8784   2557    2577   1113  1210  1210   8784
# ℹ 25 more rows</preformat>
    </sec>
    </sec>
    <p>For station</p>
    <sec id="cell-27611194-f3ed-49cc-8e90-1aff8e42199a-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Station &lt;- df_01 |&gt;
  group_by(Station.name) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) 
Table_NA_by_Station</code>
    <sec id="cell-27611194-f3ed-49cc-8e90-1aff8e42199a-output-0-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    60336  11164   14270  26524 14004 14004  60336
2 Sainshand      59040  11727   11929   9320  8527  8527  59040
3 UB             76656   7879    8716   3770  4053  4053  43415
4 Zamynuud       67392   8880   10075   3444  4960  4960  67392</preformat>
    </sec>
    </sec>
    <p>By percentages</p>
    <sec id="ed2e9bcd-1b73-41fd-9c8f-6d4259846cdc-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Station_percentage &lt;- df_01 |&gt;
  group_by(Station.name, Year) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) |&gt; 
  mutate(
            NA_PM2p = if_else(NA_date != NA_PM2, NA_PM2/NA_date*100, 0)
  ) |&gt;
  do({
    PM10_perc &lt;- .$NA_PM2*100/.$NA_date; 
      missing_PM10 &lt;-mean(PM10_perc); 
      attr(missing_PM10, &quot;data.all&quot;) &lt;- PM10_perc; 
    PM2_perc &lt;- .$NA_PM10*100/.$NA_date; 
      missing_PM2 &lt;- mean(PM2_perc); 
      attr(missing_PM2, &quot;data.all&quot;) &lt;- PM2_perc;
    Vis_perc &lt;- .$NA_Vis*100/.$NA_date; 
      missing_Vis &lt;- mean(Vis_perc); 
      attr(missing_Vis, &quot;data.all&quot;) &lt;- Vis_perc; 
    WS_perc &lt;- .$NA_WS*100/.$NA_date; 
      missing_WS &lt;- mean(WS_perc); 
      attr(missing_WS, &quot;data.all&quot;) &lt;- WS_perc; 
    WD_perc &lt;- .$NA_WD*100/.$NA_date; 
      missing_WD &lt;- mean(WD_perc); 
      attr(missing_WD, &quot;data.all&quot;) &lt;- WD_perc; 
  data.frame(missing_PM2, missing_PM10, missing_Vis, missing_WS, missing_WD)}) </code>
    <sec id="ed2e9bcd-1b73-41fd-9c8f-6d4259846cdc-output-0-nb-article" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="ed2e9bcd-1b73-41fd-9c8f-6d4259846cdc-output-1-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 4 × 6
# Groups:   Station.name [4]
  Station.name missing_PM2 missing_PM10 missing_Vis missing_WS missing_WD
  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Dalanzadgad         25.7         19.2       44.5       24.3       24.3 
2 Sainshand           20.0         19.7       15.7       14.6       14.6 
3 UB                  11.9         11.0        4.53       4.85       4.85
4 Zamynuud            14.4         12.7        5.49       7.44       7.44</preformat>
    </sec>
    </sec>
  </sec>
</sec>
<sec id="note-that-nb-article">
  <title>3. Note that:</title>
  <p>We use the data in the period of 2009-2018, which has been regarded
  as a monitoring work stabilized since 2008 when is the beginning of
  the monitoring. According to NIES, site maintenance was consistent up
  to 2018. - Sainshand site, data 2009-2015 get used; - Dalanzad site:
  2009-2016. - UB: 2009-2018 - Zamyn uud: 2009-2018</p>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table-nb-article">
  <title>4. Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages. ### Remove the
  spikes Method 1. Mean value +- (3-5)SD - Find Monthly mean</p>
  <sec id="fd99a90e-b35f-444e-9266-0647e467854f-nb-article" specific-use="notebook-code">
  <code language="python">df_02 &lt;- df_01 |&gt;
  filter(Station.name==&quot;UB&quot; ) |&gt;
  drop_na(PM2, PM10) |&gt;
    dplyr::mutate_at(vars(PM2, PM10), 
                   ~ ifelse(near(., mean(.), sd(.) * 3), ., &quot;Outlier&quot;)) |&gt;
  dplyr::filter_if(is.character, any_vars(. == &quot;Outlier&quot;))
df_02</code>
  <sec id="fd99a90e-b35f-444e-9266-0647e467854f-output-0-nb-article" specific-use="notebook-output">
  <preformat># A tibble: 1,798 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     2    17 Outl… 0.29        3622   141 0.524    NA UB          
 2  2009     1     3    12 Outl… 0.446       2399   109 0.117    NA UB          
 3  2009     1     3    13 Outl… 0.288       1347    17 0.492    NA UB          
 4  2009     1     3    14 Outl… 0.504       1241    12 0.829    NA UB          
 5  2009     1     3    15 Outl… 0.478       1341    11 0.39     NA UB          
 6  2009     1     3    16 Outl… 0.449       2945   136 0.123    NA UB          
 7  2009     1     3    18 Outl… 0.341       1436    13 0.742    NA UB          
 8  2009     1     3    19 Outl… 0.397       1847    13 0.453    NA UB          
 9  2009     1     3    20 Outl… 0.297       3359    22 0.462    NA UB          
10  2009     1     4     2 Outl… 0.311       3167    96 0.759    NA UB          
# ℹ 1,788 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  </sec>
  </sec>
  <sec id="cell-760da2a9-67df-46da-a182-a8b7eca76aac-nb-article" specific-use="notebook-code">
  <code language="python">df_02 &lt;- df_01 |&gt;
  drop_na(PM2, PM10) |&gt;
    dplyr::mutate_at(vars(PM2, PM10), 
                   ~ ifelse(near(., mean(., .by = c(Station.name, Month)), sd(.) * 3), ., &quot;Outlier&quot;)) |&gt;
  dplyr::filter_if(is.character, any_vars(. == &quot;Outlier&quot;))
df_02</code>
  <sec id="cell-760da2a9-67df-46da-a182-a8b7eca76aac-output-0-nb-article" specific-use="notebook-output">
  <preformat># A tibble: 4,014 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     3    15 Outl… 0.292       3444   119 0.856    NA Dalanzadgad 
 2  2009     1     5    13 Outl… 0.419       1383   260 1.7      NA Dalanzadgad 
 3  2009     1     5    14 Outl… 0.415       1072   266 1.84     NA Dalanzadgad 
 4  2009     1     5    15 Outl… 0.466       1099   261 0.83     NA Dalanzadgad 
 5  2009     1     5    16 Outl… 0.509       1814   260 0.788    NA Dalanzadgad 
 6  2009     1     6     0 Outl… 0.547        744   248 1.23     NA Dalanzadgad 
 7  2009     1     6     1 Outl… 0.728       1093   277 0.738    NA Dalanzadgad 
 8  2009     1     6     2 Outl… 0.597       1723     0 1.62     NA Dalanzadgad 
 9  2009     1     6     3 Outl… 0.33        8186    95 1.1      NA Dalanzadgad 
10  2009     1     6    11 Outl… 0.39        1150   258 1.48     NA Dalanzadgad 
# ℹ 4,004 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  </sec>
  </sec>
  <sec id="save-dataset-in-folder-01_data_raw-nb-article">
    <title>4.1 Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data-nb-article">
  <title>5. Tidy data</title>
  <sec id="fill-the-missing-data-nb-article">
    <title>5.1 Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy-nb-article">
    <title>5.2 Save dataset in folder: 02_data_tidy</title>
  </sec>
  <sec id="introduction-nb-article">
    <title>5.3 Introduction</title>
    <sec id="nb-code-cell-1-nb-article" specific-use="notebook-code">
    <code language="r script">eruptions &lt;- c(1492, 1585, 1646, 1677, 1712, 1949, 1971, 2021)
n_eruptions &lt;- length(eruptions)</code>
    </sec>
    <sec id="cell-fig-timeline-nb-article" specific-use="notebook-code">
    <code language="r script">par(mar = c(3, 1, 1, 1) + 0.1)
plot(eruptions, rep(0, n_eruptions), 
  pch = &quot;|&quot;, axes = FALSE)
axis(1)
box()</code>
    <fig id="fig-timeline-nb-article">
      <caption><p>Figure 1: Timeline of recent earthquakes on La
      Palma</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-timeline-1.png" />
    </fig>
    </sec>
    <sec id="nb-code-cell-2-nb-article" specific-use="notebook-code">
    <code language="r script">avg_years_between_eruptions &lt;- mean(diff(eruptions[-n_eruptions]))
avg_years_between_eruptions</code>
    <sec id="nb-code-cell-2-output-0-nb-article" specific-use="notebook-output">
    <preformat>[1] 79.83333</preformat>
    </sec>
    </sec>
    <p>Based on data up to and including 1971, eruptions on La Palma
    happen every 79.8 years on average.</p>
    <p>Studies of the magma systems feeding the volcano, such as Marrero
    et al.
    (<xref alt="2019" rid="ref-marrero2019-nb-article" ref-type="bibr">2019</xref>),
    have proposed that there are two main magma reservoirs feeding the
    Cumbre Vieja volcano; one in the mantle (30-40km depth) which
    charges and in turn feeds a shallower crustal reservoir (10-20km
    depth).</p>
    <p>Eight eruptions have been recorded since the late 1400s
    (<xref alt="Figure 1" rid="fig-timeline-nb-article">Figure 1</xref>).</p>
    <p>Data and methods are discussed in
    <xref alt="Section 0.1" rid="sec-data-methods-nb-article">Section 0.1</xref>.</p>
    <p>Let <inline-formula><alternatives>
    <tex-math><![CDATA[x]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
    denote the number of eruptions in a year. Then,
    <inline-formula><alternatives>
    <tex-math><![CDATA[x]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
    can be modeled by a Poisson distribution</p>
    <p><styled-content id="eq-poisson-nb-article"><disp-formula><alternatives>
    <tex-math><![CDATA[
    p(x) = \frac{e^{-\lambda} \lambda^{x}}{x !}
     \qquad(1)]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mi>λ</mml:mi><mml:mi>x</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>!</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="2.0em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></styled-content></p>
    <p>where <inline-formula><alternatives>
    <tex-math><![CDATA[\lambda]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>λ</mml:mi></mml:math></alternatives></inline-formula>
    is the rate of eruptions per year. Using
    <xref alt="Equation 1" rid="eq-poisson-nb-article">Equation 1</xref>, the
    probability of an eruption in the next
    <inline-formula><alternatives>
    <tex-math><![CDATA[t]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>t</mml:mi></mml:math></alternatives></inline-formula>
    years can be calculated.</p>
    <fig id="tbl-history-nb-article">
      <caption><p>Table 1: Recent historic eruptions on La
      Palma</p></caption>
      <table-wrap>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Year</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Current</td>
              <td>2021</td>
            </tr>
            <tr>
              <td>Teneguía</td>
              <td>1971</td>
            </tr>
            <tr>
              <td>Nambroque</td>
              <td>1949</td>
            </tr>
            <tr>
              <td>El Charco</td>
              <td>1712</td>
            </tr>
            <tr>
              <td>Volcán San Antonio</td>
              <td>1677</td>
            </tr>
            <tr>
              <td>Volcán San Martin</td>
              <td>1646</td>
            </tr>
            <tr>
              <td>Tajuya near El Paso</td>
              <td>1585</td>
            </tr>
            <tr>
              <td>Montaña Quemada</td>
              <td>1492</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
    <p><xref alt="Table 1" rid="tbl-history-nb-article">Table 1</xref> summarises
    the eruptions recorded since the colonization of the islands by
    Europeans in the late 1400s.</p>
    <fig id="fig-map-nb-article">
      <caption><p>Figure 2: Map of La Palma</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/la-palma-map.png" />
    </fig>
    <p>La Palma is one of the west most islands in the Volcanic
    Archipelago of the Canary Islands
    (<xref alt="Figure 2" rid="fig-map-nb-article">Figure 2</xref>).</p>
    <sec id="cell-fig-spatial-plot-nb-article" specific-use="notebook-code">
    <code language="python">la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()</code>
    <sec id="cell-fig-spatial-plot-output-0-nb-article" specific-use="notebook-output">
    <fig id="fig-spatial-plot-nb-article">
      <caption><p>Figure 3: Locations of earthquakes on La Palma since
      2017</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" />
    </fig>
    </sec>
    </sec>
    <p>kk</p>
  </sec>
</sec>
<sec id="explore-earthquakes-nb-article">
  <title>6. Explore Earthquakes</title>
  <p>Munkhtsetseg</p>
  <p>Library</p>
  <sec id="cell-1f1608a3-4bf3-4c27-8614-6d1a767c434f-nb-article" specific-use="notebook-code">
  <code language="python">library(tidyverse)</code>
  <sec id="cell-1f1608a3-4bf3-4c27-8614-6d1a767c434f-output-0-nb-article" specific-use="notebook-output">
  <preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
  </sec>
  </sec>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates-1-nb-article">
  <title>7. Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <sec id="c8cec5fd-eb64-4eb1-8fd5-a6865d705034-nb-article" specific-use="notebook-code">
  <code language="python">df &lt;- read.csv(&quot;~/Data Input/Preprocessing data/Preprocessing data.csv&quot;)</code>
  </sec>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="df0d7204-1cb9-42c7-86c6-0dd6ed97843f-nb-article" specific-use="notebook-code">
  <code language="python">df_01 &lt;- df %&gt;%
  distinct()</code>
  </sec>
  <sec id="produce-a-table-with-missing-data-1-nb-article">
    <title>7.1 Produce a table with missing data</title>
    <p>For date options as year, month, etc:</p>
    <sec id="cell-2615e4b9-cda8-4732-b724-b78211bffec6-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Year &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name,Year) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
            ) </code>
    <sec id="cell-2615e4b9-cda8-4732-b724-b78211bffec6-output-0-nb-article" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="cell-2615e4b9-cda8-4732-b724-b78211bffec6-output-1-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 52 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2008    4630   1543    1672   1463  1566  1566   4630
 2 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 3 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 4 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 5 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 6 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 7 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 8 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 9 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
10 Dalanzadgad   2017    3264     36      45   3264  3264  3264   3264
# ℹ 42 more rows</preformat>
    </sec>
    </sec>
    <p>For station</p>
    <sec id="cell-6c50b2ca-74ca-4cf2-8296-5036d057272d-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Station &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) 
Table_NA_by_Station</code>
    <sec id="cell-6c50b2ca-74ca-4cf2-8296-5036d057272d-output-0-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    69454  13081   16327  32475 20058 20058  69454
2 Sainshand     101230  27588   36117  28986 13768 13768 101230
3 UB             95662   7895    8785   3775  4121  4121  62421
4 Zamynuud       99742  32281   33597  22525  5373  5373  99742</preformat>
    </sec>
    </sec>
    <p>By percentages</p>
    <sec id="f8f5c95f-b42e-4b66-9f9f-067721a41c18-nb-article" specific-use="notebook-code">
    <code language="python">Table_NA_by_Station_percentage &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name, Year) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) %&gt;% 
  mutate(
            NA_PM2p = if_else(NA_date != NA_PM2, NA_PM2/NA_date*100, 0)
  ) %&gt;%
  do({q &lt;- .$NA_PM2*100/.$NA_date; sdq &lt;- sd(q); attr(sdq, &quot;data.all&quot;) &lt;- q; data.frame(sdq)}) </code>
    <sec id="f8f5c95f-b42e-4b66-9f9f-067721a41c18-output-0-nb-article" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="f8f5c95f-b42e-4b66-9f9f-067721a41c18-output-1-nb-article" specific-use="notebook-output">
    <preformat># A tibble: 4 × 2
# Groups:   Station.name [4]
  Station.name   sdq
  &lt;chr&gt;        &lt;dbl&gt;
1 Dalanzadgad   10.7
2 Sainshand     25.9
3 UB            17.9
4 Zamynuud      39.6</preformat>
    </sec>
    </sec>
    <p>Note that the <monospace>echo = FALSE</monospace> parameter was
    added to the code chunk to prevent printing of the R code that
    generated the plot.</p>
  </sec>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table-1-nb-article">
  <title>8. Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages.</p>
  <sec id="remove-the-spikes-method-1.-mean-value---3-5sd-nb-article">
    <title>8.0.1 Remove the spikes Method 1. Mean value +-
    (3-5)SD</title>
    <p>Method 2. Seasonal variations, and trend-mean</p>
  </sec>
  <sec id="save-dataset-in-folder-01_data_raw-1-nb-article">
    <title>8.1 Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data-1-nb-article">
  <title>9. Tidy data</title>
  <sec id="fill-the-missing-data-1-nb-article">
    <title>9.1 Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy-1-nb-article">
    <title>9.2 Save dataset in folder: 02_data_tidy</title>
    <sec id="a5e17f62-f862-4752-b8a5-614fed058ccc-nb-article" specific-use="notebook-code">
    <code language="python">library(tidyverse)</code>
    </sec>
    <p>Read a clean version of data:</p>
    <sec id="cell-1e66349d-bf96-473a-8704-7885d3409910-nb-article" specific-use="notebook-code">
    <code language="python">la_palma &lt;- read_csv(&quot;la-palma.csv&quot;)</code>
    <sec id="cell-1e66349d-bf96-473a-8704-7885d3409910-output-0-nb-article" specific-use="notebook-output">
    <preformat>Rows: 11347 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl  (4): Longitude, Latitude, Depth(km), Magnitude
dttm (1): DateTime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</preformat>
    </sec>
    </sec>
    <p>Create spatial plot:</p>
    <sec id="cell-fig-spatial-plot-nb-article" specific-use="notebook-code">
    <code language="python">la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()</code>
    <sec id="cell-fig-spatial-plot-output-0-nb-article" specific-use="notebook-output">
    <fig id="fig-spatial-plot-nb-article">
      <caption><p>Figure 4: Locations of earthquakes on La Palma since
      2017</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-01-earthquakes-fig-spatial-plot-output-1.png" />
    </fig>
    </sec>
    </sec>
    <p><xref alt="Figure 4" rid="fig-spatial-plot-nb-article">Figure 4</xref> shows
    the location of recent Earthquakes on La Palma.</p>
  </sec>
  <sec id="sec-results-nb-article">
    <title>9.3 Results</title>
  </sec>
  <sec id="sec-discussion-nb-article">
    <title>9.4 Discussion</title>
  </sec>
  <sec id="sec-conclusions-nb-article">
    <title>9.5 Conclusions</title>
  </sec>
  <sec id="references-nb-article">
    <title>References</title>
    <ref-list>
      <ref id="ref-marrero2019-nb-article">
        <element-citation publication-type="article-journal">
          <person-group person-group-type="author">
            <name><surname>Marrero</surname><given-names>José</given-names></name>
            <name><surname>García</surname><given-names>Alicia</given-names></name>
            <name><surname>Berrocoso</surname><given-names>Manuel</given-names></name>
            <name><surname>Llinares</surname><given-names>Ángeles</given-names></name>
            <name><surname>Rodríguez-Losada</surname><given-names>Antonio</given-names></name>
            <name><surname>Ortiz</surname><given-names>R.</given-names></name>
          </person-group>
          <article-title>Strategies for the development of volcanic hazard maps in monogenetic volcanic fields: The example of La Palma (Canary Islands)</article-title>
          <source>Journal of Applied Volcanology</source>
          <year iso-8601-date="2019-07">2019</year><month>07</month>
          <volume>8</volume>
          <pub-id pub-id-type="doi">10.1186/s13617-019-0085-5</pub-id>
          <fpage></fpage>
          <lpage></lpage>
        </element-citation>
      </ref>
    </ref-list>
  </sec>
</sec>
</body>



<back>
</back>


</sub-article>
<sub-article article-type="notebook" id="nb-4-nb-1">
<front-stub>
<title-group>
<article-title>Explore Earthquakes</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Munkhtsetseg</surname>
<given-names></given-names>
</name>
<string-name>Munkhtsetseg</string-name>

</contrib>
</contrib-group>
</front-stub>

<body>
<p>Library</p>
<sec id="nb-code-cell-1-nb-1" specific-use="notebook-code">
<code language="r script">library(tidyverse)
</code>
<code language="r script">library(ggplot2)
</code>
<sec id="nb-code-cell-1-output-0-nb-1" specific-use="notebook-output">
<preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
</sec>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates-nb-1">
  <title>Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <sec id="nb-code-cell-2-nb-1" specific-use="notebook-code">
  <code language="r script">df &lt;- read.csv(&quot;~/Data Input/Preprocessing data/Preprocessing data.csv&quot;)
  </code>
  </sec>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="nb-code-cell-3-nb-1" specific-use="notebook-code">
  <code language="r script">df_01 &lt;- df %&gt;%
  distinct()
  </code>
  </sec>
  <sec id="produce-a-table-with-missing-data-nb-1">
    <title>Produce a table with missing data</title>
    <p>For date options as year, month, etc:</p>
    <sec id="nb-code-cell-4-nb-1" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Year &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name,Year) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
            ) 
    </code>
    <code language="r script">Table_NA_by_Year
    </code>
    <sec id="nb-code-cell-4-output-0-nb-1" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="nb-code-cell-4-output-1-nb-1" specific-use="notebook-output">
    <preformat># A tibble: 52 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2008    4630   1543    1672   1463  1566  1566   4630
 2 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 3 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 4 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 5 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 6 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 7 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 8 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 9 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
10 Dalanzadgad   2017    3264     36      45   3264  3264  3264   3264
# ℹ 42 more rows</preformat>
    </sec>
    </sec>
    <p>For station</p>
    <sec id="nb-code-cell-5-nb-1" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Station &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) 
Table_NA_by_Station
    </code>
    <sec id="nb-code-cell-5-output-0-nb-1" specific-use="notebook-output">
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    69454  13081   16327  32475 20058 20058  69454
2 Sainshand     101230  27588   36117  28986 13768 13768 101230
3 UB             95662   7895    8785   3775  4121  4121  62421
4 Zamynuud       99742  32281   33597  22525  5373  5373  99742</preformat>
    </sec>
    </sec>
    <p>By percentages</p>
    <sec id="nb-code-cell-6-nb-1" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Station_percentage &lt;- df_01 %&gt;%
  rowwise %&gt;%
  group_by(Station.name, Year) %&gt;% 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) %&gt;% 
  mutate(
            NA_PM2p = if_else(NA_date != NA_PM2, NA_PM2/NA_date*100, 0)
  ) %&gt;%
  do({q &lt;- .$NA_PM2*100/.$NA_date; sdq &lt;- sd(q); attr(sdq, &quot;data.all&quot;) &lt;- q; data.frame(sdq)}) 
    </code>
    <code language="r script"> Table_NA_by_Station_percentage
    </code>
    <sec id="nb-code-cell-6-output-0-nb-1" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="nb-code-cell-6-output-1-nb-1" specific-use="notebook-output">
    <preformat># A tibble: 4 × 2
# Groups:   Station.name [4]
  Station.name   sdq
  &lt;chr&gt;        &lt;dbl&gt;
1 Dalanzadgad   10.7
2 Sainshand     25.9
3 UB            17.9
4 Zamynuud      39.6</preformat>
    </sec>
    </sec>
    <p>Note that the <monospace>echo = FALSE</monospace> parameter was
    added to the code chunk to prevent printing of the R code that
    generated the plot.</p>
  </sec>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table-nb-1">
  <title>Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages.</p>
  <sec id="remove-the-spikes-method-1.-mean-value---3-5sd-nb-1">
    <title>Remove the spikes Method 1. Mean value +- (3-5)SD</title>
    <p>Method 2. Seasonal variations, and trend-mean</p>
  </sec>
  <sec id="save-dataset-in-folder-01_data_raw-nb-1">
    <title>Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data-nb-1">
  <title>Tidy data</title>
  <sec id="fill-the-missing-data-nb-1">
    <title>Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy-nb-1">
    <title>Save dataset in folder: 02_data_tidy</title>
    <sec id="nb-code-cell-7-nb-1" specific-use="notebook-code">
    <code language="r script">library(tidyverse)
    </code>
    </sec>
    <p>Read a clean version of data:</p>
    <sec id="nb-code-cell-8-nb-1" specific-use="notebook-code">
    <code language="r script">la_palma &lt;- read_csv(&quot;la-palma.csv&quot;)
    </code>
    <sec id="nb-code-cell-8-output-0-nb-1" specific-use="notebook-output">
    <preformat>Rows: 11347 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl  (4): Longitude, Latitude, Depth(km), Magnitude
dttm (1): DateTime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</preformat>
    </sec>
    </sec>
    <p>Create spatial plot:</p>
    <sec id="cell-fig-spatial-plot-nb-1" specific-use="notebook-code">
    <code language="r script">#|   against longitude.&quot;
la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()
    </code>
    <fig id="fig-spatial-plot-nb-1">
      <caption><p>Locations of earthquakes on La Palma since
      2017</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="01-earthquakes_files/figure-jats/fig-spatial-plot-1.png" />
    </fig>
    </sec>
  </sec>
</sec>
</body>



<back>
</back>


</sub-article>
<sub-article article-type="notebook" id="nb-8-nb-2">
<front-stub>
<title-group>
<article-title>Explore Earthquakes</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Wickham</surname>
<given-names>Charlotte</given-names>
</name>
<string-name>Charlotte Wickham</string-name>

</contrib>
</contrib-group>
</front-stub>

<body>
<sec id="nb-code-cell-1-nb-2" specific-use="notebook-code">
<code language="r script">library(tidyverse)
</code>
<sec id="nb-code-cell-1-output-0-nb-2" specific-use="notebook-output">
<preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
</sec>
</sec>
<p>Read a clean version of data:</p>
<sec id="nb-code-cell-2-nb-2" specific-use="notebook-code">
<code language="r script">la_palma &lt;- read_csv(&quot;la-palma.csv&quot;)
</code>
<sec id="nb-code-cell-2-output-0-nb-2" specific-use="notebook-output">
<preformat>Rows: 11347 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl  (4): Longitude, Latitude, Depth(km), Magnitude
dttm (1): DateTime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</preformat>
</sec>
</sec>
<p>Create spatial plot:</p>
<sec id="cell-fig-spatial-plot-nb-2" specific-use="notebook-code">
<code language="r script">#|   against longitude.&quot;
la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()
</code>
<fig id="fig-spatial-plot-nb-2">
  <caption><p>Locations of earthquakes on La Palma since
  2017</p></caption>
  <graphic mimetype="image" mime-subtype="png" xlink:href="explore-earthquakes_files/figure-jats/fig-spatial-plot-1.png" />
</fig>
</sec>
</body>



<back>
</back>


</sub-article>
<sub-article article-type="notebook" id="nb-12-nb-3">
<front-stub>
<title-group>
<article-title>01_datawork</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Munkhtsetseg</surname>
<given-names></given-names>
</name>
<string-name>Munkhtsetseg</string-name>

</contrib>
</contrib-group>
</front-stub>

<body>
<p>Library</p>
<sec id="nb-code-cell-1-nb-3" specific-use="notebook-code">
<code language="r script">library(tidyverse)
</code>
<code language="r script">library(ggplot2)
</code>
<sec id="nb-code-cell-1-output-0-nb-3" specific-use="notebook-output">
<preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
</sec>
</sec>
<sec id="import-the-dataset-and-remove-the-duplicates-nb-3">
  <title>Import the dataset and remove the duplicates</title>
  <p>Import the dataset from the directory of: ~/Data
  Input/Preprocessing data/Preprocessing data.csv, assign the dataset as
  object of df:</p>
  <sec id="nb-code-cell-2-nb-3" specific-use="notebook-code">
  <code language="r script">df &lt;- read.csv(&quot;~/Data Input/Preprocessing data/Preprocessing data.csv&quot;)
  </code>
  </sec>
  <p>Remove the duplicates with the function of distinct(), assign the
  dataset as df_01:</p>
  <sec id="nb-code-cell-3-nb-3" specific-use="notebook-code">
  <code language="r script">df_00 &lt;- df |&gt;
  distinct()
  </code>
  </sec>
  <sec id="produce-a-table-with-missing-data-nb-3">
    <title>Produce a table with missing data</title>
    <sec id="nb-code-cell-4-nb-3" specific-use="notebook-code">
    <code language="r script">df_000 &lt;- df_00 |&gt;
   filter(Year&lt;2019 &amp; Year &gt;2008)



df_01 &lt;- df_000 |&gt;
   select(Year, Month, Day, Hour, PM2, PM10, Visibility, WD, WS,   OPC, Station.name, Date) |&gt;
  rowwise() |&gt;
filter((Year != 2019 &amp; Station.name == &quot;Zamynuud&quot;) | 
       (Year &lt; 2016 &amp; Station.name == &quot;Sainshand&quot;) |
       (Year &lt; 2021 &amp; Station.name == &quot;UB&quot;) |
       (Year &lt; 2017 &amp; Station.name == &quot;Dalanzadgad&quot;)
       )
    </code>
    </sec>
    <p>For date options as year, month, etc:</p>
    <sec id="nb-code-cell-5-nb-3" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Year &lt;- df_01 |&gt;
  group_by(Station.name,Year) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
            ) 
    </code>
    <code language="r script">Table_NA_by_Year
    </code>
    <sec id="nb-code-cell-5-output-0-nb-3" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="nb-code-cell-5-output-1-nb-3" specific-use="notebook-output">
    <preformat># A tibble: 35 × 9
# Groups:   Station.name [4]
   Station.name  Year NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 Dalanzadgad   2009    8760    715     929    659   748   748   8760
 2 Dalanzadgad   2010    8784    921    1086    756   787   787   8784
 3 Dalanzadgad   2011    8760   2652    3309   1759  2394  2394   8760
 4 Dalanzadgad   2012    5088   1074    3016    693  1412  1412   5088
 5 Dalanzadgad   2013    6096   1766    1809   2479  1240  1240   6096
 6 Dalanzadgad   2014    7800    843     921   6068  1482  1482   7800
 7 Dalanzadgad   2015    8760   1539    1587   8115  2635  2635   8760
 8 Dalanzadgad   2016    6288   1654    1613   5995  3306  3306   6288
 9 Sainshand     2009    8688    376     424    423   587   587   8688
10 Sainshand     2010    8784   2557    2577   1113  1210  1210   8784
# ℹ 25 more rows</preformat>
    </sec>
    </sec>
    <p>For station</p>
    <sec id="nb-code-cell-6-nb-3" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Station &lt;- df_01 |&gt;
  group_by(Station.name) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) 
Table_NA_by_Station
    </code>
    <sec id="nb-code-cell-6-output-0-nb-3" specific-use="notebook-output">
    <preformat># A tibble: 4 × 8
  Station.name NA_date NA_PM2 NA_PM10 NA_Vis NA_WD NA_WS NA_OPC
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Dalanzadgad    60336  11164   14270  26524 14004 14004  60336
2 Sainshand      59040  11727   11929   9320  8527  8527  59040
3 UB             76656   7879    8716   3770  4053  4053  43415
4 Zamynuud       67392   8880   10075   3444  4960  4960  67392</preformat>
    </sec>
    </sec>
    <p>By percentages</p>
    <sec id="nb-code-cell-7-nb-3" specific-use="notebook-code">
    <code language="r script">Table_NA_by_Station_percentage &lt;- df_01 |&gt;
  group_by(Station.name, Year) |&gt; 
  summarise(NA_date = sum(!is.na(Date)),
            NA_PM2 = sum(is.na(PM2)),
            NA_PM10 = sum(is.na(PM10)),
            NA_Vis = sum(is.na(Visibility)),
            NA_WD = sum(is.na(WD)),
            NA_WS = sum(is.na(WS)),
            NA_OPC = sum(is.na(OPC))
  ) |&gt; 
  mutate(
            NA_PM2p = if_else(NA_date != NA_PM2, NA_PM2/NA_date*100, 0)
  ) |&gt;
  do({
    PM10_perc &lt;- .$NA_PM2*100/.$NA_date; 
      missing_PM10 &lt;-mean(PM10_perc); 
      attr(missing_PM10, &quot;data.all&quot;) &lt;- PM10_perc; 
    PM2_perc &lt;- .$NA_PM10*100/.$NA_date; 
      missing_PM2 &lt;- mean(PM2_perc); 
      attr(missing_PM2, &quot;data.all&quot;) &lt;- PM2_perc;
    Vis_perc &lt;- .$NA_Vis*100/.$NA_date; 
      missing_Vis &lt;- mean(Vis_perc); 
      attr(missing_Vis, &quot;data.all&quot;) &lt;- Vis_perc; 
    WS_perc &lt;- .$NA_WS*100/.$NA_date; 
      missing_WS &lt;- mean(WS_perc); 
      attr(missing_WS, &quot;data.all&quot;) &lt;- WS_perc; 
    WD_perc &lt;- .$NA_WD*100/.$NA_date; 
      missing_WD &lt;- mean(WD_perc); 
      attr(missing_WD, &quot;data.all&quot;) &lt;- WD_perc; 
  data.frame(missing_PM2, missing_PM10, missing_Vis, missing_WS, missing_WD)}) 
    </code>
    <code language="r script"> Table_NA_by_Station_percentage
    </code>
    <sec id="nb-code-cell-7-output-0-nb-3" specific-use="notebook-output">
    <preformat>`summarise()` has grouped output by 'Station.name'. You can override using the
`.groups` argument.</preformat>
    </sec>
    <sec id="nb-code-cell-7-output-1-nb-3" specific-use="notebook-output">
    <preformat># A tibble: 4 × 6
# Groups:   Station.name [4]
  Station.name missing_PM2 missing_PM10 missing_Vis missing_WS missing_WD
  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Dalanzadgad         25.7         19.2       44.5       24.3       24.3 
2 Sainshand           20.0         19.7       15.7       14.6       14.6 
3 UB                  11.9         11.0        4.53       4.85       4.85
4 Zamynuud            14.4         12.7        5.49       7.44       7.44</preformat>
    </sec>
    </sec>
  </sec>
</sec>
<sec id="note-that-nb-3">
  <title>Note that:</title>
  <p>We use the data in the period of 2009-2018, which has been regarded
  as a monitoring work stabilized since 2008 when is the beginning of
  the monitoring. According to NIES, site maintenance was consistent up
  to 2018. - Sainshand site, data 2009-2015 get used; - Dalanzad site:
  2009-2016. - UB: 2009-2018 - Zamyn uud: 2009-2018</p>
</sec>
<sec id="remove-the-spikes-and-produce-an-extended-table-nb-3">
  <title>Remove the spikes, and produce an extended table</title>
  <p>Remove the spikes in the datasets, and produce the table with NA,
  with removed spikes; express it in a percentages. ### Remove the
  spikes Method 1. Mean value +- (3-5)SD - Find Monthly mean</p>
  <sec id="nb-code-cell-8-nb-3" specific-use="notebook-code">
  <code language="r script">df_02 &lt;- df_01 |&gt;
  filter(Station.name==&quot;UB&quot; ) |&gt;
  drop_na(PM2, PM10) |&gt;
    dplyr::mutate_at(vars(PM2, PM10), 
                   ~ ifelse(near(., mean(.), sd(.) * 3), ., &quot;Outlier&quot;)) |&gt;
  dplyr::filter_if(is.character, any_vars(. == &quot;Outlier&quot;))
df_02
  </code>
  <sec id="nb-code-cell-8-output-0-nb-3" specific-use="notebook-output">
  <preformat># A tibble: 1,798 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     2    17 Outl… 0.29        3622   141 0.524    NA UB          
 2  2009     1     3    12 Outl… 0.446       2399   109 0.117    NA UB          
 3  2009     1     3    13 Outl… 0.288       1347    17 0.492    NA UB          
 4  2009     1     3    14 Outl… 0.504       1241    12 0.829    NA UB          
 5  2009     1     3    15 Outl… 0.478       1341    11 0.39     NA UB          
 6  2009     1     3    16 Outl… 0.449       2945   136 0.123    NA UB          
 7  2009     1     3    18 Outl… 0.341       1436    13 0.742    NA UB          
 8  2009     1     3    19 Outl… 0.397       1847    13 0.453    NA UB          
 9  2009     1     3    20 Outl… 0.297       3359    22 0.462    NA UB          
10  2009     1     4     2 Outl… 0.311       3167    96 0.759    NA UB          
# ℹ 1,788 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  </sec>
  </sec>
  <sec id="nb-code-cell-9-nb-3" specific-use="notebook-code">
  <code language="r script">df_02 &lt;- df_01 |&gt;
  drop_na(PM2, PM10) |&gt;
    dplyr::mutate_at(vars(PM2, PM10), 
                   ~ ifelse(near(., mean(., .by = c(Station.name, Month)), sd(.) * 3), ., &quot;Outlier&quot;)) |&gt;
  dplyr::filter_if(is.character, any_vars(. == &quot;Outlier&quot;))
df_02
  </code>
  <sec id="nb-code-cell-9-output-0-nb-3" specific-use="notebook-output">
  <preformat># A tibble: 4,014 × 12
    Year Month   Day  Hour PM2   PM10  Visibility    WD    WS   OPC Station.name
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       
 1  2009     1     3    15 Outl… 0.292       3444   119 0.856    NA Dalanzadgad 
 2  2009     1     5    13 Outl… 0.419       1383   260 1.7      NA Dalanzadgad 
 3  2009     1     5    14 Outl… 0.415       1072   266 1.84     NA Dalanzadgad 
 4  2009     1     5    15 Outl… 0.466       1099   261 0.83     NA Dalanzadgad 
 5  2009     1     5    16 Outl… 0.509       1814   260 0.788    NA Dalanzadgad 
 6  2009     1     6     0 Outl… 0.547        744   248 1.23     NA Dalanzadgad 
 7  2009     1     6     1 Outl… 0.728       1093   277 0.738    NA Dalanzadgad 
 8  2009     1     6     2 Outl… 0.597       1723     0 1.62     NA Dalanzadgad 
 9  2009     1     6     3 Outl… 0.33        8186    95 1.1      NA Dalanzadgad 
10  2009     1     6    11 Outl… 0.39        1150   258 1.48     NA Dalanzadgad 
# ℹ 4,004 more rows
# ℹ 1 more variable: Date &lt;chr&gt;</preformat>
  </sec>
  </sec>
  <sec id="save-dataset-in-folder-01_data_raw-nb-3">
    <title>Save dataset in folder: 01_data_raw</title>
  </sec>
</sec>
<sec id="tidy-data-nb-3">
  <title>Tidy data</title>
  <sec id="fill-the-missing-data-nb-3">
    <title>Fill the missing data</title>
    <p>Method 1. Fill the gap Method 2. Relationship equation Method 3.
    Look-up table</p>
  </sec>
  <sec id="save-dataset-in-folder-02_data_tidy-nb-3">
    <title>Save dataset in folder: 02_data_tidy</title>
  </sec>
</sec>
</body>



<back>
</back>


</sub-article>

</article>